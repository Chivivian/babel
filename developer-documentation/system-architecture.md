# Babel System Architecture

> **Version**: 1.0.0  
> **Last Updated**: December 24, 2024  
> **Status**: Stage-0 Design

---

## Overview

Babel is a **document translation platform** that combines Agentic OCR with Large Language Models to deliver accurate, structure-preserving translations. This document provides the complete technical architecture.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            BABEL PLATFORM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   Users     â”‚    â”‚   Admins    â”‚    â”‚  Library    â”‚    â”‚   API       â”‚  â”‚
â”‚   â”‚  Dashboard  â”‚    â”‚  Dashboard  â”‚    â”‚  Browser    â”‚    â”‚  Clients    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                  â”‚                  â”‚                  â”‚         â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        API GATEWAY                                   â”‚   â”‚
â”‚   â”‚                   (AWS API Gateway + WAF)                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚          â–¼                         â–¼                         â–¼              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚   Auth      â”‚          â”‚   Core      â”‚          â”‚   Admin     â”‚         â”‚
â”‚   â”‚  Service    â”‚          â”‚   API       â”‚          â”‚   API       â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                         â”‚                         â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                    â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    TRANSLATION ENGINE                                â”‚   â”‚
â”‚   â”‚                       (BabelDOC)                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Table of Contents

1. [High-Level Architecture](#1-high-level-architecture)
2. [Frontend Architecture](#2-frontend-architecture)
3. [Backend Services](#3-backend-services)
4. [Translation Engine](#4-translation-engine)
5. [Data Layer](#5-data-layer)
6. [Authentication & Authorization](#6-authentication--authorization)
7. [Infrastructure](#7-infrastructure)
8. [API Design](#8-api-design)
9. [Security Architecture](#9-security-architecture)
10. [Monitoring & Observability](#10-monitoring--observability)

---

## 1. High-Level Architecture

### 1.1 System Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRESENTATION LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ User Web    â”‚  â”‚ Admin Web   â”‚  â”‚ Library     â”‚  â”‚ Mobile      â”‚     â”‚
â”‚  â”‚ Dashboard   â”‚  â”‚ Dashboard   â”‚  â”‚ Portal      â”‚  â”‚ (Future)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           API LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    AWS API Gateway                               â”‚    â”‚
â”‚  â”‚              (Rate Limiting, WAF, SSL Termination)               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         SERVICE LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Auth    â”‚ â”‚   User    â”‚ â”‚Translationâ”‚ â”‚  Credit   â”‚ â”‚  Library  â”‚  â”‚
â”‚  â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚   Admin   â”‚ â”‚  Billing  â”‚ â”‚  Audit    â”‚                              â”‚
â”‚  â”‚  Service  â”‚ â”‚  Service  â”‚ â”‚  Service  â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        PROCESSING LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    BabelDOC Engine                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ Parser  â”‚â†’â”‚ OCR     â”‚â†’â”‚ Extract â”‚â†’â”‚Translateâ”‚â†’â”‚ Rebuild â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          DATA LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚PostgreSQL â”‚ â”‚    S3     â”‚ â”‚   Redis   â”‚ â”‚CloudWatch â”‚                â”‚
â”‚  â”‚ (Primary) â”‚ â”‚(Documents)â”‚ â”‚  (Cache)  â”‚ â”‚  (Logs)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Component Summary

| Component | Technology | Purpose |
|-----------|------------|---------|
| **User Dashboard** | HTML/CSS/JS | User-facing translation interface |
| **Admin Dashboard** | HTML/CSS/JS | Administrative control center |
| **API Gateway** | AWS API Gateway | Request routing, rate limiting |
| **Core API** | FastAPI (Python) | Business logic, orchestration |
| **BabelDOC Engine** | Python | Document parsing & translation |
| **Database** | PostgreSQL (RDS) | Persistent data storage |
| **File Storage** | AWS S3 | Document storage |
| **Cache** | Redis (ElastiCache) | Session & response caching |
| **Auth** | AWS Cognito | Identity management |
| **Queue** | AWS SQS | Async job processing |

---

## 2. Frontend Architecture

### 2.1 Application Structure

```
front/
â”œâ”€â”€ index.html              # Landing page
â”œâ”€â”€ dashboard.html          # Translation interface
â”œâ”€â”€ library.html            # Public library browser
â”œâ”€â”€ pricing.html            # Pricing & checkout
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ main.css            # Global styles
â”‚   â”œâ”€â”€ components.css      # UI components
â”‚   â””â”€â”€ themes/
â”‚       â”œâ”€â”€ light.css
â”‚       â””â”€â”€ dark.css
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ app.js              # Main application
â”‚   â”œâ”€â”€ auth.js             # Cognito integration
â”‚   â”œâ”€â”€ api.js              # API client
â”‚   â”œâ”€â”€ upload.js           # File upload handler
â”‚   â”œâ”€â”€ translate.js        # Translation logic
â”‚   â””â”€â”€ billing.js          # Stripe/PayPal
â””â”€â”€ assets/
    â””â”€â”€ images/

admin/
â”œâ”€â”€ index.html              # Admin login
â”œâ”€â”€ dashboard.html          # Metrics overview
â”œâ”€â”€ users.html              # User management
â”œâ”€â”€ translations.html       # Compliance viewer
â”œâ”€â”€ analytics.html          # Reports
â”œâ”€â”€ settings.html           # Configuration
â””â”€â”€ js/
    â”œâ”€â”€ admin-app.js
    â”œâ”€â”€ admin-auth.js
    â””â”€â”€ admin-api.js
```

### 2.2 Authentication Flow (Frontend)

```mermaid
sequenceDiagram
    participant User
    participant App
    participant Cognito
    participant API

    User->>App: Click Sign In
    App->>Cognito: Redirect to Hosted UI
    User->>Cognito: Authenticate (Google/Microsoft/Email)
    Cognito->>App: Return tokens (ID, Access, Refresh)
    App->>App: Store tokens in memory
    App->>API: Request with Access Token
    API->>API: Verify token
    API->>App: Return data
```

### 2.3 State Management

| State Type | Storage | Lifetime |
|------------|---------|----------|
| **Auth Tokens** | Memory (JS variable) | Session |
| **Refresh Token** | HttpOnly Cookie | 30 days |
| **User Preferences** | LocalStorage | Persistent |
| **Translation Jobs** | Memory | Session |

---

## 3. Backend Services

### 3.1 Service Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ECS FARGATE CLUSTER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     API SERVICE (FastAPI)                        â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ /auth   â”‚ â”‚ /users  â”‚ â”‚/translateâ”‚ â”‚/credits â”‚ â”‚/library â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    WORKER SERVICE                                â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚              Translation Job Processor                   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  SQS Poll â†’ Download â†’ BabelDOC â†’ Upload â†’ Notify       â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ADMIN SERVICE (FastAPI)                       â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚/dashboardâ”‚ â”‚ /users  â”‚ â”‚ /audit  â”‚ â”‚/settingsâ”‚ â”‚/analyticsâ”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 API Service Modules

```python
# Project Structure
babel-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                 # FastAPI application
â”‚   â”œâ”€â”€ config.py               # Configuration
â”‚   â”œâ”€â”€ dependencies.py         # Dependency injection
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ auth.py             # Authentication endpoints
â”‚   â”‚   â”œâ”€â”€ users.py            # User management
â”‚   â”‚   â”œâ”€â”€ translate.py        # Translation jobs
â”‚   â”‚   â”œâ”€â”€ credits.py          # Credit operations
â”‚   â”‚   â”œâ”€â”€ library.py          # Public library
â”‚   â”‚   â””â”€â”€ billing.py          # Payment webhooks
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ auth_service.py     # Cognito integration
â”‚   â”‚   â”œâ”€â”€ user_service.py     # User business logic
â”‚   â”‚   â”œâ”€â”€ translation_service.py
â”‚   â”‚   â”œâ”€â”€ credit_service.py
â”‚   â”‚   â”œâ”€â”€ library_service.py
â”‚   â”‚   â”œâ”€â”€ stripe_service.py
â”‚   â”‚   â””â”€â”€ paypal_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ user.py             # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ translation.py
â”‚   â”‚   â”œâ”€â”€ credit.py
â”‚   â”‚   â””â”€â”€ library.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ user.py             # Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ translation.py
â”‚   â”‚   â””â”€â”€ credit.py
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ security.py         # Token validation
â”‚       â”œâ”€â”€ storage.py          # S3 operations
â”‚       â””â”€â”€ queue.py            # SQS operations
â”‚
â”œâ”€â”€ worker/
â”‚   â”œâ”€â”€ main.py                 # Worker entry point
â”‚   â”œâ”€â”€ processor.py            # Job processing
â”‚   â””â”€â”€ babeldoc/               # Translation engine
â”‚
â”œâ”€â”€ tests/
â”œâ”€â”€ requirements.txt
â””â”€â”€ Dockerfile
```

### 3.3 Service Communication

```mermaid
flowchart LR
    subgraph Frontend
        A[User Dashboard]
        B[Admin Dashboard]
    end

    subgraph API_Gateway[API Gateway]
        C[Rate Limiter]
        D[WAF]
    end

    subgraph Services
        E[API Service]
        F[Worker Service]
        G[Admin Service]
    end

    subgraph Data
        H[(PostgreSQL)]
        I[(S3)]
        J[(Redis)]
        K[SQS]
    end

    A --> C --> E
    B --> C --> G
    E --> H
    E --> I
    E --> J
    E --> K
    F --> K
    F --> I
    F --> H
    G --> H
```

---

## 4. Translation Engine

### 4.1 BabelDOC Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BABELDOC ENGINE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  INPUT                                                                  â”‚
â”‚    â”‚                                                                    â”‚
â”‚    â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚   PARSER    â”‚  Detect format (PDF, DOCX, etc.)                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  ANALYZER   â”‚  Layout detection, structure mapping                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚    OCR      â”‚  Agentic OCR for scanned content                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  EXTRACTOR  â”‚  Term extraction, paragraph grouping                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ TRANSLATOR  â”‚  OpenAI GPT-4o API calls                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  REBUILDER  â”‚  Reconstruct document with translations                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                               â”‚
â”‚         â–¼                                                               â”‚
â”‚  OUTPUT (Translated Document)                                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Translation Job Lifecycle

| Status | Description |
|--------|-------------|
| `PENDING` | Job queued, waiting for worker |
| `PROCESSING` | Worker picked up job |
| `PARSING` | Document being analyzed |
| `TRANSLATING` | LLM translation in progress |
| `REBUILDING` | Reconstructing output document |
| `COMPLETED` | Translation finished, download ready |
| `FAILED` | Error occurred (with error message) |

### 4.3 Supported Formats

| Format | Input | Output | Notes |
|--------|-------|--------|-------|
| **PDF** | âœ… | âœ… | Full layout preservation |
| **DOCX** | âœ… | âœ… | Styles preserved |
| **PPTX** | ðŸ”œ | ðŸ”œ | Stage-2 |
| **XLSX** | ðŸ”œ | ðŸ”œ | Stage-2 |
| **TXT** | âœ… | âœ… | Plain text |

---

## 5. Data Layer

### 5.1 Database Schema

```mermaid
erDiagram
    users {
        uuid id PK
        string cognito_sub UK
        string email UK
        string name
        string avatar_url
        enum auth_provider
        enum plan
        int credits_balance
        enum status
        timestamp created_at
        timestamp last_login_at
    }

    translations {
        uuid id PK
        uuid user_id FK
        string source_language
        string target_language
        int character_count
        enum status
        string source_file_key
        string output_file_key
        string error_message
        timestamp created_at
        timestamp completed_at
    }

    credit_transactions {
        uuid id PK
        uuid user_id FK
        enum type
        int amount
        int balance_after
        string description
        uuid reference_id
        timestamp created_at
    }

    subscriptions {
        uuid id PK
        uuid user_id FK
        enum plan
        string stripe_subscription_id
        string paypal_agreement_id
        timestamp current_period_start
        timestamp current_period_end
        enum status
    }

    library_entries {
        uuid id PK
        uuid user_id FK
        uuid translation_id FK
        string title
        string description
        array tags
        int view_count
        int download_count
        enum status
        timestamp published_at
    }

    audit_logs {
        uuid id PK
        uuid admin_id FK
        string action
        string target_type
        uuid target_id
        string reason
        jsonb metadata
        timestamp created_at
    }

    users ||--o{ translations : "creates"
    users ||--o{ credit_transactions : "has"
    users ||--o| subscriptions : "has"
    users ||--o{ library_entries : "publishes"
    translations ||--o| library_entries : "becomes"
```

### 5.2 Storage Architecture

| Data Type | Storage | Encryption | Retention |
|-----------|---------|------------|-----------|
| **User profiles** | PostgreSQL | AES-256 | Account lifetime |
| **Translation metadata** | PostgreSQL | AES-256 | Indefinite |
| **Source documents** | S3 | AES-256 + KMS | 90 days |
| **Output documents** | S3 | AES-256 + KMS | 90 days |
| **Library documents** | S3 | AES-256 + KMS | Indefinite |
| **Audit logs** | CloudWatch + S3 | Encrypted | 7 years |

### 5.3 S3 Bucket Structure

```
babel-documents-{env}/
â”œâ”€â”€ uploads/
â”‚   â””â”€â”€ {user_id}/
â”‚       â””â”€â”€ {job_id}/
â”‚           â””â”€â”€ source.pdf
â”œâ”€â”€ outputs/
â”‚   â””â”€â”€ {user_id}/
â”‚       â””â”€â”€ {job_id}/
â”‚           â””â”€â”€ translated.pdf
â””â”€â”€ library/
    â””â”€â”€ {entry_id}/
        â””â”€â”€ document.pdf

babel-static-{env}/
â”œâ”€â”€ css/
â”œâ”€â”€ js/
â”œâ”€â”€ images/
â””â”€â”€ fonts/
```

---

## 6. Authentication & Authorization

### 6.1 AWS Cognito Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS COGNITO                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      USER POOL                                   â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  Identity Providers:                                             â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Email/Password (native)                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Google (OAuth 2.0)                                          â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Microsoft (OAuth 2.0)                                       â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  Attributes:                                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ email (required, verified)                                  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ name                                                        â”‚    â”‚
â”‚  â”‚  â””â”€â”€ picture                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ADMIN USER POOL                               â”‚    â”‚
â”‚  â”‚                  (Separate for security)                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Token Structure

| Token | Contents | Lifetime | Usage |
|-------|----------|----------|-------|
| **ID Token** | User identity claims | 1 hour | Display user info |
| **Access Token** | Authorization scopes | 1 hour | API authentication |
| **Refresh Token** | Session identifier | 30 days | Silent token refresh |

### 6.3 Authorization Matrix

| Resource | Guest | User | Admin | Super Admin |
|----------|-------|------|-------|-------------|
| View public library | âœ… | âœ… | âœ… | âœ… |
| Create translation | âŒ | âœ… | âœ… | âœ… |
| View own translations | âŒ | âœ… | âœ… | âœ… |
| Publish to library | âŒ | âœ… | âœ… | âœ… |
| View user list | âŒ | âŒ | âœ… | âœ… |
| Adjust user credits | âŒ | âŒ | âœ… | âœ… |
| Access user content | âŒ | âŒ | âŒ | âœ… (logged) |
| Platform settings | âŒ | âŒ | âŒ | âœ… |

---

## 7. Infrastructure

### 7.1 AWS Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AWS CLOUD                                  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          VPC                                     â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Public Subnets    â”‚    â”‚      Private Subnets            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚                                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      ALB      â”‚  â”‚    â”‚  â”‚     ECS Fargate         â”‚    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚    â”‚  â”‚  â”‚ API â”‚ â”‚Adminâ”‚ â”‚Workrâ”‚â”‚    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  NAT Gateway  â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚                                 â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â”‚         RDS             â”‚    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â”‚     (PostgreSQL)        â”‚    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚                                 â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â”‚     ElastiCache         â”‚    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â”‚       (Redis)           â”‚    â”‚  â”‚    â”‚
â”‚  â”‚                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚    â”‚
â”‚  â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ CloudFront â”‚ â”‚     S3     â”‚ â”‚    SQS     â”‚ â”‚  Cognito   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Scaling Configuration

| Component | Min | Max | Trigger |
|-----------|-----|-----|---------|
| **API Service** | 2 | 10 | CPU > 70% |
| **Worker Service** | 1 | 20 | SQS queue depth |
| **Admin Service** | 1 | 3 | CPU > 70% |
| **RDS** | - | - | Read replicas on demand |

### 7.3 Environment Configurations

| Environment | Purpose | Resources |
|-------------|---------|-----------|
| **Development** | Local testing | Docker Compose |
| **Staging** | Pre-production | Minimal AWS (single-AZ) |
| **Production** | Live system | Multi-AZ, full redundancy |

---

## 8. API Design

### 8.1 RESTful Endpoints

#### Authentication
```
POST   /api/v1/auth/register       # Complete registration
POST   /api/v1/auth/refresh        # Refresh tokens
POST   /api/v1/auth/logout         # Invalidate session
```

#### Users
```
GET    /api/v1/users/me            # Current user profile
PATCH  /api/v1/users/me            # Update profile
DELETE /api/v1/users/me            # Request deletion
GET    /api/v1/users/me/credits    # Credit balance
GET    /api/v1/users/me/transactions # Credit history
```

#### Translations
```
POST   /api/v1/translations        # Create job
GET    /api/v1/translations        # List user's jobs
GET    /api/v1/translations/:id    # Job status
GET    /api/v1/translations/:id/download # Download result
DELETE /api/v1/translations/:id    # Cancel job
```

#### Library
```
GET    /api/v1/library             # Browse public entries
GET    /api/v1/library/:id         # Entry details
POST   /api/v1/library             # Publish translation
DELETE /api/v1/library/:id         # Unpublish (owner)
POST   /api/v1/library/:id/report  # Report content
```

#### Billing
```
POST   /api/v1/billing/checkout    # Create checkout session
POST   /api/v1/billing/portal      # Customer portal link
POST   /api/v1/webhooks/stripe     # Stripe webhook
POST   /api/v1/webhooks/paypal     # PayPal webhook
```

#### Admin
```
GET    /api/v1/admin/dashboard     # Metrics
GET    /api/v1/admin/users         # User list
GET    /api/v1/admin/users/:id     # User details
PATCH  /api/v1/admin/users/:id     # Update user
POST   /api/v1/admin/users/:id/credits # Adjust credits
GET    /api/v1/admin/translations  # All translations
GET    /api/v1/admin/audit-logs    # Audit trail
```

### 8.2 Response Formats

#### Success Response
```json
{
  "success": true,
  "data": { ... },
  "meta": {
    "timestamp": "2024-12-24T12:00:00Z",
    "request_id": "req_abc123"
  }
}
```

#### Error Response
```json
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_CREDITS",
    "message": "You need 5,000 more credits to translate this document",
    "details": {
      "required": 15000,
      "available": 10000
    }
  },
  "meta": {
    "timestamp": "2024-12-24T12:00:00Z",
    "request_id": "req_abc123"
  }
}
```

### 8.3 Rate Limits

| Tier | Requests/min | Concurrent Jobs |
|------|--------------|-----------------|
| **Free** | 10 | 1 |
| **Starter** | 30 | 3 |
| **Growth** | 60 | 5 |
| **Business** | 120 | 10 |
| **Enterprise** | Custom | Custom |

---

## 9. Security Architecture

### 9.1 Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SECURITY LAYERS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  EDGE                                                                   â”‚
â”‚  â”œâ”€â”€ CloudFront (DDoS protection)                                       â”‚
â”‚  â”œâ”€â”€ AWS WAF (SQL injection, XSS blocking)                              â”‚
â”‚  â””â”€â”€ Rate limiting (per IP, per user)                                   â”‚
â”‚                                                                         â”‚
â”‚  TRANSPORT                                                              â”‚
â”‚  â”œâ”€â”€ TLS 1.3 (all connections)                                          â”‚
â”‚  â””â”€â”€ Certificate pinning (mobile future)                                â”‚
â”‚                                                                         â”‚
â”‚  APPLICATION                                                            â”‚
â”‚  â”œâ”€â”€ Input validation (Pydantic schemas)                                â”‚
â”‚  â”œâ”€â”€ CSRF protection                                                    â”‚
â”‚  â”œâ”€â”€ Content Security Policy                                            â”‚
â”‚  â””â”€â”€ JWT verification (Cognito public keys)                             â”‚
â”‚                                                                         â”‚
â”‚  DATA                                                                   â”‚
â”‚  â”œâ”€â”€ Encryption at rest (AES-256)                                       â”‚
â”‚  â”œâ”€â”€ Encryption in transit (TLS)                                        â”‚
â”‚  â”œâ”€â”€ KMS key management                                                 â”‚
â”‚  â””â”€â”€ Field-level encryption (sensitive data)                            â”‚
â”‚                                                                         â”‚
â”‚  AUDIT                                                                  â”‚
â”‚  â”œâ”€â”€ CloudTrail (API calls)                                             â”‚
â”‚  â”œâ”€â”€ Application audit logs                                             â”‚
â”‚  â””â”€â”€ GuardDuty (threat detection)                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Compliance Controls

| Requirement | Implementation |
|-------------|----------------|
| **GDPR** | Data export, deletion, consent management |
| **CCPA** | Privacy disclosures, opt-out |
| **SOC 2** | Access controls, audit logging |
| **PCI DSS** | Stripe/PayPal handle card data |

---

## 10. Monitoring & Observability

### 10.1 Monitoring Stack

| Layer | Tool | Metrics |
|-------|------|---------|
| **Infrastructure** | CloudWatch | CPU, memory, network |
| **Application** | CloudWatch Logs | Errors, latency |
| **Business** | Custom Dashboard | Translations, revenue |
| **Alerting** | CloudWatch Alarms + SNS | Incidents |

### 10.2 Key Metrics

| Metric | Alert Threshold |
|--------|-----------------|
| API latency (p99) | > 2000ms |
| Error rate | > 1% |
| Queue depth | > 100 |
| Failed translations | > 5% |
| Credit depletion | User at 0 |

### 10.3 Logging Strategy

```
{
  "timestamp": "2024-12-24T12:00:00.000Z",
  "level": "INFO",
  "service": "api",
  "request_id": "req_abc123",
  "user_id": "usr_xyz789",
  "action": "translation.create",
  "duration_ms": 150,
  "metadata": {
    "source_lang": "en",
    "target_lang": "de",
    "character_count": 5000
  }
}
```

---

## Appendix: Quick Reference

### Tech Stack Summary

| Layer | Technology |
|-------|------------|
| **Frontend** | HTML, CSS, JavaScript |
| **Backend** | Python, FastAPI |
| **Database** | PostgreSQL |
| **Cache** | Redis |
| **Queue** | AWS SQS |
| **Storage** | AWS S3 |
| **Auth** | AWS Cognito |
| **CDN** | AWS CloudFront |
| **Compute** | AWS ECS Fargate |
| **LLM** | OpenAI GPT-4o |

### Key URLs (Production)

| Service | URL |
|---------|-----|
| **User Dashboard** | https://app.babel.lunartech.com |
| **Admin Dashboard** | https://admin.babel.lunartech.com |
| **API** | https://api.babel.lunartech.com |
| **Public Library** | https://library.babel.lunartech.com |

---

> **Document Status**: Complete  
> **Prepared by**: LunarTech Development Team
